<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Wheel of Names | Random Name Picker</title>

    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            
            background-color:#e6fff9;
        }

        /* Wheel pointer */
        #pointer {
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 30px 16px 0 16px;
            border-color: #e53e3e transparent transparent transparent;
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            transition: border-color 0.3s ease;
        }

        /* Center container */
        #canvas-container {
            position: relative;
            max-width: 550px;
            min-width:530px;
            margin:-70px 100px 0 100px;
            aspect-ratio: 1 / 1;
            
        }

        #header{background-color:transparent;width:100%;height:50px;display:flex;align-items:center;justify-content: space-between;}
        #header h1{margin-left:35px;font-size:25px;font-weight:900;color:grey}
        #icon{margin-right:35px;font-size:20px !important;color:grey !important}
        #entrylistcon{width:300px;margin-top:-30px;padding-bottom:10px}
        #entrylist{background-color:white;width:100%;border-radius:10px;padding:20px;box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);}
        
        /* Modal animation */
        @keyframes modal-appear {
            0% { transform: scale(0.8) translateY(20px); opacity: 0; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }
        
        .modal-animated {
            animation: modal-appear 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* Winner text animation */
        @keyframes winner-glow {
            0% { text-shadow: 0 0 5px rgba(79, 70, 229, 0.5); }
            50% { text-shadow: 0 0 20px rgba(79, 70, 229, 0.8), 0 0 30px rgba(79, 70, 229, 0.6); }
            100% { text-shadow: 0 0 5px rgba(79, 70, 229, 0.5); }
        }
        
        .winner-glow {
            animation: winner-glow 2s infinite;
        }

        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* Color picker styling */
        .color-picker {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #fff;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }
        
        .color-picker:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .color-picker.active {
            transform: scale(1.15);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.5);
        }
        
        /* Custom range slider */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e5e7eb;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            background: #4338ca;
            transform: scale(1.1);
        }
        
        /* Confetti animation */
        .confetti {
            position: absolute;
            width: 12px;
            height: 12px;
            opacity: 0.8;
            border-radius: 0;
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(1000px) rotate(360deg); opacity: 0; }
        }
        
        /* Spin button animation */
        @keyframes spin-icon {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinning {
            animation: spin-icon 1s linear infinite;
        }
        
        /* Glass morphism effect for modal */
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Elegant shadow for elements */
        .elegant-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Falling colors animation */
        @keyframes falling-colors {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        .falling-color {
            position: fixed;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            z-index: 9999;
            pointer-events: none;
            animation: falling-colors 5s linear forwards;
        }

footer{width:100%;height:70px;background-color:#f2f2f2;margin-top:200px}
footer a{font-size:14px;margin-left:40px;line-height:70px}

@media screen and (min-device-width: 500px) and (max-device-width: 900px) { 
  #header{background-color:white;width:100%;height:50px;display:flex;align-items:center;justify-content: space-between;}
        #header h1{margin-left:15px;font-size:18px;font-weight:900;color:grey}
        #icon{margin-right:15px;font-size:20px !important;color:grey !important}
        #entrylistcon{width:230px;margin-top:-30px;padding-bottom:10px;float:left}
        #entrylist{background-color:white;width:100%;border-radius:10px;padding:20px;box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);}

 #canvas-container {
            position:absolute;
            max-width: 350px;
            min-width:350px;
            top:120px;
            right:-20px;
           
        }
}


        
@media screen and (min-device-width: 281px) and (max-device-width: 500px) { 
  #header{background-color:white;width:100%;height:50px;display:flex;align-items:center;justify-content: space-between;}
        #header h1{margin-left:15px;font-size:18px;font-weight:900;color:grey}
        #icon{margin-right:15px;font-size:20px !important;color:grey !important}
        #entrylistcon{width:90%;margin-top:20px;padding-bottom:10px;margin:auto}
        #entrylist{background-color:white;width:100%;border-radius:10px;padding:20px;box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);}

 #canvas-container {
            position: relative;
            max-width: 95%;
            min-width:95%;
            margin:20px auto;
            aspect-ratio: 1 / 1;
            
        }
footer{width:100%;height:auto;background-color:#f2f2f2;margin-top:400px;padding-bottom:10px}
footer a{font-size:14px;margin-left:20px;display:block;margin-bottom:-20px}        
 }       
    </style>
</head>
<body class="min-h-screen flex flex-col">


    <div id="header">
     <h1 style="display: flex; align-items: center; gap: 8px;">
  <span contenteditable="true">Wheel of Names</span>
  <span style="cursor: pointer;">üñäÔ∏è</span>
</h1>
     <div id="icon">
     <button id="soundToggle" class="bg-20 hover:bg-black/30 text-black p-2 rounded-full transition duration-300 backdrop-blur-sm">
                    <svg id="soundOnIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828a1 1 0 010-1.415z" clip-rule="evenodd" />
                    </svg>
                    <svg id="soundOffIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
                <button id="settingsToggle" class="bg-/20 hover:bg-black/30 text-black p-2 rounded-full transition duration-300 backdrop-blur-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </button>
     </div>           

    </div>

    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12 w-full">
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
            
            <!-- Left Panel: Input & Controls -->
            <div id="entrylistcon">
                <div id="entrylist">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Entries List</h2>
                    
                    <textarea id="nameInput" rows="12" 
                        class="w-full p-3 border-2 border-indigo-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 text-gray-700 resize-none custom-scrollbar" 
                        placeholder="Enter names, one per line (e.g., John, Jane, Mike, etc.)"
                    ></textarea>
                    
                    <div class="flex space-x-2 mt-4">
                        <button id="shuffleButton" 
                            class="flex-1 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-semibold py-2.5 rounded-xl transition duration-300 ease-in-out transform hover:scale-[1.02]"
                            onclick="shuffleNames()"
                            title="Shuffle the order of entries"
                        >
                            Shuffle
                        </button>
                        <button id="sortButton" 
                            class="flex-1 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-semibold py-2.5 rounded-xl transition duration-300 ease-in-out transform hover:scale-[1.02]"
                            onclick="sortNames()"
                            title="Sort entries alphabetically"
                        >
                            Sort
                        </button>
                    </div>

                    <p id="entryCount" class="text-sm text-gray-500 mt-2 text-center font-medium"></p>

                </div>
            </div>

            <!-- Center Panel: The Wheel -->
            <div class="">
                <div id="canvas-container" class="relative">
                    <div id="pointer" class="transition-all duration-100"></div>
                    <canvas id="wheelCanvas" class="rounded-full elegant-shadow border-4 border-white bg-white"></canvas>
                    <button id="spinButton" 
                        class="absolute inset-0 m-auto w-28 h-28 md:w-32 md:h-32 bg-gradient-to-br from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white rounded-full elegant-shadow border-4 border-white transition duration-300 ease-in-out transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-4 focus:ring-indigo-300 disabled:from-gray-400 disabled:to-gray-500 disabled:shadow-none flex items-center justify-center"
                        onclick="startSpin()"
                    >
                        <svg id="spinIcon" xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                    </button>
                </div>
            </div>
            
        </div>
        
        <!-- Settings Panel -->
        <div id="settingsPanel" class="hidden mt-8 bg-white p-6 rounded-xl elegant-shadow border border-gray-100">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Customization Settings</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Color Customization -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Wheel Colors</h3>
                    <div id="colorPickers" class="flex flex-wrap gap-3 mb-4"></div>
                    <p class="text-sm text-gray-500">Click on a color to change the corresponding segment color</p>
                </div>
                
                <!-- Spin Duration Settings -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Spin Duration</h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm text-gray-600">Spin Duration</span>
                                <span id="spinDurationValue" class="text-sm font-medium text-indigo-600">5 seconds</span>
                            </div>
                            <input type="range" id="spinDuration" min="3" max="15" value="5" class="w-full">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>3s</span>
                                <span>15s</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sound Settings -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Sound Settings</h3>
                    <div class="space-y-3">
                        <div class="flex items-center">
                            <input type="checkbox" id="winSoundToggle" class="custom-checkbox mr-3" checked>
                            <label for="winSoundToggle" class="text-gray-700">Enable celebration sound</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Winner Modal -->
    <div id="resultModal" class="hidden fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
        <div id="modalContent" class="glass-effect p-8 rounded-2xl elegant-shadow max-w-lg w-full transform transition-all relative">
            <button id="closeModalBtn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </div>
                <h3 class="text-3xl font-bold gradient-text mb-2">Congratulations!</h3>
                <p class="text-gray-600">The wheel has selected a winner</p>
            </div>
            
            <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-xl border border-indigo-100 mb-6">
                <p id="winnerText" class="text-4xl font-black text-center text-indigo-700 winner-glow break-words"></p>
            </div>
            
            <div class="flex space-x-4">
                <button id="removeWinnerBtn"
                    class="flex-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-3 rounded-xl transition duration-300 transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-red-300 flex items-center justify-center" 
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    Remove Winner
                </button>
                <button id="keepWinnerBtn"
                    class="flex-1 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white font-semibold py-3 rounded-xl transition duration-300 transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-indigo-300 flex items-center justify-center" 
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    Continue
                </button>
            </div>
        </div>
    </div>
    
    <footer>
        <a href="https://www.wheelofname.org">Wheel of Names</a>
        <a href="https://www.wheelofname.org/random-name-generator-wheel">Random Name Generator</a>
        <a href="https://www.wheelofname.org/fantasy-nickname-generator">Fantasy Nickname Generator</a>
         <a href="https://www.wheelofname.org/cute-name-generator">Cute Name Generator</a>
         <a href="https://www.wheelofname.org/about" style="float:right;margin-right:5px">About</a>
        <a href="https://x.com/wheelsofnames" style="float:right;margin-right:5px" target="_blank">X</a>
         <a href="https://www.youtube.com/channel/UCqNLKBTXi8LFsK81c4xwmFQ" style="float:right;margin-right:5px" target="_blank">Youtube</a>
         
    </footer>

    <script>
        // --- Global Variables and Constants ---
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const nameInput = document.getElementById('nameInput');
        const spinButton = document.getElementById('spinButton');
        const spinIcon = document.getElementById('spinIcon');
        const resultModal = document.getElementById('resultModal');
        const modalContent = document.getElementById('modalContent');
        const winnerText = document.getElementById('winnerText');
        const entryCountEl = document.getElementById('entryCount');
        const pointerEl = document.getElementById('pointer');
        const settingsPanel = document.getElementById('settingsPanel');
        const settingsToggle = document.getElementById('settingsToggle');
        const soundToggle = document.getElementById('soundToggle');
        const soundOnIcon = document.getElementById('soundOnIcon');
        const soundOffIcon = document.getElementById('soundOffIcon');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const removeWinnerBtn = document.getElementById('removeWinnerBtn');
        const keepWinnerBtn = document.getElementById('keepWinnerBtn');
        const spinDurationSlider = document.getElementById('spinDuration');
        const spinDurationValue = document.getElementById('spinDurationValue');
        const colorPickersContainer = document.getElementById('colorPickers');

        // Initial setup
        let names = [];
        let totalRotation = 0;
        let isSpinning = false;
        let lastWinner = null;
        let isSoundEnabled = true;
        let spinDuration = 5; // Default spin duration in seconds
        let settings = { winSound: true };

        // Color palette
        let colors = ['#a5b4fc','#67e8f9','#fcd34d','#fda4af','#4ade80','#f97316','#818cf8','#ef4444'];

        // Audio for celebration sound
        const celebrationSound = new Audio('sound.mp3');
        let isSoundPlaying = false;

        // Initialize with example names
        setDefaultNames();

        // --- Utility Functions (Shuffle/Sort) ---
        function updateInputAndSave() {
            nameInput.value = names.join('\n');
            updateWheel();
            updateColorPickers();
        }

        function shuffleNames() {
            if (isSpinning) return;
            for (let i = names.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [names[i], names[j]] = [names[j], names[i]];
            }
            updateInputAndSave();
        }

        function sortNames() {
            if (isSpinning) return;
            names.sort((a, b) => a.localeCompare(b, undefined, { sensitivity: 'base' }));
            updateInputAndSave();
        }

        // --- Canvas Drawing Logic ---
        function setCanvasSize() {
            const container = document.getElementById('canvas-container');
            const size = container.offsetWidth;
            canvas.width = size;
            canvas.height = size;
        }

        window.addEventListener('resize', () => {
            setCanvasSize();
            drawWheel();
        });

        // Initial size setup
        setCanvasSize();

        function updateWheel() {
            const rawInput = nameInput.value;
            const newNames = rawInput.split('\n').map(name => name.trim()).filter(name => name.length > 0);

            if (newNames.length === 0) {
                spinButton.disabled = true;
                names = [];
                colors = ['#a5b4fc','#67e8f9','#fcd34d','#fda4af','#4ade80','#f97316','#818cf8','#ef4444'];
            } else {
                spinButton.disabled = isSpinning;
                names = newNames;
                while (colors.length < names.length) {
                    colors.push(colors[Math.floor(Math.random() * colors.length)]);
                }
                colors = colors.slice(0, names.length);
            }

            entryCountEl.textContent = `${names.length} active entries.`;
            updateColorPickers();
            drawWheel();
        }

        function updateColorPickers() {
            colorPickersContainer.innerHTML = '';
            names.forEach((_, index) => {
                const picker = document.createElement('input');
                picker.type = 'color';
                picker.className = 'color-picker';
                picker.value = colors[index] || '#a5b4fc';
                picker.addEventListener('change', (e) => {
                    colors[index] = e.target.value;
                    drawWheel();
                });
                colorPickersContainer.appendChild(picker);
            });
        }

        function drawWheel() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) * 0.98;
            const total = names.length;

            if (total === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.textAlign = 'center';
                ctx.fillStyle = '#6b7280';
                ctx.font = '20px Inter';
                ctx.fillText('Add names to the list!', centerX, centerY);
                return;
            }

            const arc = (2 * Math.PI) / total;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Apply current rotation
            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(totalRotation * (Math.PI / 180));

            // Dynamic Font Size
            const fontSize = total > 15 ? 14 : (total > 8 ? 16 : 20);
            ctx.font = `600 ${fontSize}px Inter`;

            for (let i = 0; i < total; i++) {
                const startAngle = i * arc;
                const endAngle = (i + 1) * arc;

                // Draw slice
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.arc(0, 0, radius, startAngle, endAngle);
                ctx.closePath();
                ctx.fillStyle = colors[i % colors.length];
                ctx.fill();

                // Outline
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 3;
                ctx.stroke();

                // Draw Text
                ctx.save();
                ctx.rotate(startAngle + arc / 2);
                ctx.textAlign = 'right';
                ctx.fillStyle = '#1f2937';
                const textX = radius * 0.85;

                let nameToDisplay = names[i];
                if (total > 8 && nameToDisplay.length > 12) {
                    nameToDisplay = nameToDisplay.substring(0, 12) + '...';
                }

                ctx.fillText(nameToDisplay, textX, 5);
                ctx.restore();
            }

            ctx.restore();

            // Center hub
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * 0.02, 0, 2 * Math.PI);
            ctx.fillStyle = '#fff';
            ctx.fill();
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 4;
            ctx.stroke();
            
            // Update pointer color to match the current top segment
            updatePointerColor();
        }

        function updatePointerColor() {
            const total = names.length;
            if (total === 0) {
                pointerEl.style.borderColor = '#e53e3e transparent transparent transparent';
                return;
            }
            
            const winningIndex = calculateWinnerIndex();
            const segmentColor = colors[winningIndex];
            pointerEl.style.borderColor = `${segmentColor} transparent transparent transparent`;
        }

        // --- Spinning Logic ---
        function startSpin() {
            if (isSpinning || names.length === 0) return;
            isSpinning = true;
            spinButton.disabled = true;
            spinIcon.classList.add('spinning');

            const extraRotations = Math.floor(Math.random() * 6 + 7);
            const randomAngle = Math.random() * 360;
            const finalTarget = totalRotation + extraRotations * 360 + randomAngle;

            animateSpin(finalTarget);
        }

        function animateSpin(finalTarget) {
            let startTime = null;
            const duration = spinDuration * 1000;
            const startRotation = totalRotation;

            function easeOutQuint(t) { return 1 - Math.pow(1 - t, 5); }

            function step(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsed = timestamp - startTime;
                let t = Math.min(1, elapsed / duration);
                let easedT = easeOutQuint(t);
                const newRotation = startRotation + (finalTarget - startRotation) * easedT;

                totalRotation = newRotation % 360;
                drawWheel();

                if (t < 1) {
                    requestAnimationFrame(step);
                } else {
                    totalRotation = finalTarget % 360;
                    drawWheel();
                    spinIcon.classList.remove('spinning');
                    const winningIndex = calculateWinnerIndex();
                    showWinner(winningIndex);
                    isSpinning = false;
                    spinButton.disabled = names.length === 0;
                }
            }

            requestAnimationFrame(step);
        }


        function calculateWinnerIndex() {
            const total = names.length;
            if (total === 0) return 0;

            const sliceAngle = 360 / total;
            const pointerDeg = 270; // pointer is at the top


            for (let i = 0; i < total; i++) {
    
                let start = (i * sliceAngle + totalRotation) % 360;
                if (start < 0) start += 360;
                let end = (start + sliceAngle) % 360;

                if (start < end) {
                    // Normal case, no wrap
                    if (pointerDeg >= start && pointerDeg < end) {
                        return i;
                    }
                } else {
                    // Wrapped case (slice crosses 360->0 boundary)
                    if (pointerDeg >= start || pointerDeg < end) {
                        return i;
                    }
                }
            }

            // Fallback (shouldn't happen) - return 0
            return 0;
        }

        function showWinner(index) {
            lastWinner = names[index];
            winnerText.textContent = lastWinner;

            resultModal.classList.remove('hidden');
            modalContent.classList.add('modal-animated');

            createFallingColors();

            if (isSoundEnabled && settings.winSound) {
                celebrationSound.currentTime = 0;
                celebrationSound.play().then(() => {
                    isSoundPlaying = true;
                }).catch(e => console.log('Audio play failed:', e));
            }

            createConfetti();
        }

        function createFallingColors() {
            const colors = ['#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16'];

            for (let i = 0; i < 50; i++) {
                const colorElement = document.createElement('div');
                colorElement.className = 'falling-color';
                colorElement.style.left = Math.random() * 100 + 'vw';
                colorElement.style.animationDelay = Math.random() * 2 + 's';
                colorElement.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                document.body.appendChild(colorElement);

                setTimeout(() => {
                    if (colorElement.parentNode) {
                        document.body.removeChild(colorElement);
                    }
                }, 5000);
            }
        }

        function createConfetti() {
            const confettiContainer = document.createElement('div');
            confettiContainer.id = 'confetti-container';
            confettiContainer.style.position = 'fixed';
            confettiContainer.style.top = '0';
            confettiContainer.style.left = '0';
            confettiContainer.style.width = '100%';
            confettiContainer.style.height = '100%';
            confettiContainer.style.pointerEvents = 'none';
            confettiContainer.style.zIndex = '40';
            document.body.appendChild(confettiContainer);

            const colors = ['#ff6f61', '#6b5b95', '#88b04b', '#f7cac9', '#92a8d1', '#ffcc5c', '#d64161', '#ff7b25'];

            for (let i = 0; i < 200; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animation = 'confetti-fall linear forwards';
                confettiContainer.appendChild(confetti);
            }

            setTimeout(() => {
                if (document.getElementById('confetti-container')) {
                    document.body.removeChild(confettiContainer);
                }
            }, 6000);
        }

        function removeWinnerAndContinue() {
            if (lastWinner) {
                names = names.filter(name => name !== lastWinner).filter(name => name.trim().length > 0);
                if (names.length === 0) {
                    setDefaultNames();
                } else {
                    updateInputAndSave();
                }
            }
            closeModal();
        }

        function keepWinnerAndContinue() {
            closeModal();
        }

        function closeModal() {
            if (isSoundPlaying) {
                celebrationSound.pause();
                celebrationSound.currentTime = 0;
                isSoundPlaying = false;
            }

            modalContent.classList.remove('modal-animated');
            setTimeout(() => {
                resultModal.classList.add('hidden');
                lastWinner = null;
            }, 50);
        }

        function toggleSound() {
            isSoundEnabled = !isSoundEnabled;
            if (isSoundEnabled) {
                soundOnIcon.classList.remove('hidden');
                soundOffIcon.classList.add('hidden');
            } else {
                soundOnIcon.classList.add('hidden');
                soundOffIcon.classList.remove('hidden');
            }
        }

        function toggleSettings() {
            if (settingsPanel.classList.contains('hidden')) {
                settingsPanel.classList.remove('hidden');
            } else {
                settingsPanel.classList.add('hidden');
            }
        }

        function updateSpinDuration() {
            spinDuration = parseInt(spinDurationSlider.value);
            spinDurationValue.textContent = `${spinDuration} seconds`;
        }

        function setDefaultNames() {
            names = ['Alice', 'Bob', 'Charlie', 'Diana', 'Ethan', 'Fiona', 'George', 'Hannah'];
            nameInput.value = names.join('\n');
            entryCountEl.textContent = `${names.length} active entries.`;
            updateWheel();
        }

        // --- Initialization ---
        window.onload = function() {
            soundToggle.addEventListener('click', toggleSound);
            settingsToggle.addEventListener('click', toggleSettings);
            closeModalBtn.addEventListener('click', closeModal);
            removeWinnerBtn.addEventListener('click', removeWinnerAndContinue);
            keepWinnerBtn.addEventListener('click', keepWinnerAndContinue);
            spinDurationSlider.addEventListener('input', updateSpinDuration);

            nameInput.addEventListener('input', updateWheel);

            const savedSettings = localStorage.getItem('wheelSettings');
            if (savedSettings) {
                settings = JSON.parse(savedSettings);
                document.getElementById('winSoundToggle').checked = settings.winSound;
            }

            document.getElementById('winSoundToggle').addEventListener('change', function() {
                settings.winSound = this.checked;
                localStorage.setItem('wheelSettings', JSON.stringify(settings));
            });

            updateSpinDuration();
            updateWheel();
        }

        // Expose functions globally for HTML elements
        window.startSpin = startSpin;
        window.closeModal = closeModal;
        window.updateWheel = updateWheel;
        window.shuffleNames = shuffleNames;
        window.sortNames = sortNames;
        window.removeWinnerAndContinue = removeWinnerAndContinue;
        window.keepWinnerAndContinue = keepWinnerAndContinue;

    </script>
</body>

</html>
